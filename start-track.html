<!DOCTYPE html>
<html lang="en">
  <head>
    <!--metadata information -->
    <title>Start-Track-Page</title>
    <link rel="icon" type="image/x-con" href="https://pic.onlinewebfonts.com/svg/img_509228.png">
    <meta property="og:title" content="Start-Track" />

    <!--style information -->
    <style data-tag="reset-style-sheet">
      html {  line-height: 1.15;}body {  margin: 0;}* {  box-sizing: border-box;  border-width: 0;  border-style: solid;}p,li,ul,pre,div,h1,h2,h3,h4,h5,h6 {  margin: 0;  padding: 0;}button {  background-color: transparent;}button,input,optgroup,select,textarea {  font-family: inherit;  font-size: 100%;  line-height: 1.15;  margin: 0;}button,select {  text-transform: none;}button,[type="button"],[type="reset"],[type="submit"] {  -webkit-appearance: button;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner {  border-style: none;  padding: 0;}button:-moz-focus,[type="button"]:-moz-focus,[type="reset"]:-moz-focus,[type="submit"]:-moz-focus {  outline: 1px dotted ButtonText;}a {  color: inherit;  text-decoration: inherit;}input {  padding: 2px 4px;}img {  display: block;}html { scroll-behavior: smooth  }
    </style>
    <style data-tag="default-style-sheet">
      html {
        font-family: Titillium Web;
        font-size: 16px;
      }

      body {
        font-weight: 400;
        font-style:normal;
        text-decoration: none;
        text-transform: none;
        letter-spacing: normal;
        line-height: 1.15;
        color: var(--dl-color-scheme-green100);
        background-color: var(--dl-color-scheme-yellow20);

      }
    </style>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
      data-tag="font"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Urbanist:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"
      data-tag="font"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&amp;display=swap"
      data-tag="font"
    />
    <!--This is the head section-->
    <link rel="stylesheet" href="./style.css" />
  
  </head>

  <body>
    <script>
      //asks user to input user ID
      const authorized_users = ["260917220", "260909959", "260888246"];
      var userid = prompt("Please enter your ID number (no spaces):");
      var authenticated_user = false;
      if (authorized_users.indexOf(userid) >= 0) {
        document.write("\n" + "You are logged in as: " + userid);
        authenticated_user = true; 
      } else {
        alert("\n" + "Invalid user ID. Please try again.");
        document.write("\n" + "You are not logged in.");
      };

    </script>
    
    <div>
      <link href="./start-track.css" rel="stylesheet" />
      
      <div class="start-track-container">
        <!-- create navigation bar -->
        <div class="start-track-navbar navbar-container">
          <div class="start-track-max-width max-width">
            <!--creat logo thats links back to homepage -->
            <div class="start-track-logo">
              <a href="index.html" class="start-track-navlink">
                <img
                  alt="image"
                  src="public/playground_assets/group_2.svg"
                  class="start-track-image"
                />
              </a>
              <span class="start-track-text">
                <span class="start-track-text01">GROUP2 -</span>
                <span>Mobile Tracking App</span>
              </span>
            </div>
            <!--create menu that links to different subpages -->
            <div class="start-track-links">
              <a
                href="index.html"
                class="start-track-navlink1 button button-primary"
              >
                How it Works
              </a>
              <a
                href="Map.html"
                class="start-track-navlink1 button button-primary"
			        >
				      Path Visualization
			        </a>
              <a
                href="path.html"
                class="start-track-navlink1 button button-primary"
			        >
                Space Time Path
              </a>
              <a
                href="start-track.html"
                class="start-track-navlink2 button button-primary"
              >
                Log in
              </a>
            </div>
            <div class="start-track-burger-menu navbar-burger-menu">
              <svg viewBox="0 0 1024 1024" class="start-track-icon">
                <path
                  d="M128 256h768v86h-768v-86zM128 554v-84h768v84h-768zM128 768v-86h768v86h-768z"
                ></path>
              </svg>
            </div>
          </div>
        </div>
        
        <!--create start tracking button that initializes tracking process -->
        <div class="start-track-section section-container">

          <!--start tracking button-->
          <div class="start-track-text">
            <h2 id = "track" class = "start-track-navlink3 button button-primary" style = 'display:none'>Tracking</h2>
            <button id = "track_button" class = "start-track-navlink3 button button-primary" onclick = "myGeolocator(),cycle(0)">
              <span>Start Tracking</span>
            </button>
            <p id = "latlng"></p>
            <p id = "counter"></p>
          </div>
          

          <!-- add reminder text for users  -->
          <div class="start-track-max-width1 max-width">
            <div class="start-track-container1">
              <span class="start-track-title">
                <br />
                <span>
                  Click the button above and get your coordinates every 30
                  seconds!
                </span>
                <br />
                <br />
                <span>Reminder:</span>
                <br />
                <span>
                  Keep the website open while tracking your location.
                </span>
              </span>
            </div>
          </div> 
        </div> <!--close main section-->
        <!--add footer-->
        <footer class="start-track-footer">
          <span class="start-track-text10">
            <span>
              By clicking the button below, you consent to your location being
              obtained and used for the purpose of GEOG 384 - Assignment 3.
            </span>
            <br />
            <br />
            <span>Copyright 2022, GEOG 384 - Group 2, Martin Paraire,&nbsp;</span>
            <span>Erik Moore, and&nbsp;</span>
            <span>Yanbing Chen.&nbsp;All rights reserved.&nbsp;</span>
          </span>
        </footer>
      </div>
    </div>
    <script>
      window.onload = () => {
        const runAllScripts = () => {
          initializeAllAccordions()
        }

        const listenForUrlChanges = () => {
          let url = location.href
          document.body.addEventListener(
            'click',
            () => {
              requestAnimationFrame(() => {
                if (url !== location.href) {
                  runAllScripts()
                  url = location.href
                }
              })
            },
            true
          )
        }

        const initializeAllAccordions = () => {
          const allAccordions = document.querySelectorAll('[data-role="Accordion"]');

          allAccordions.forEach((accordion) => {
            const accordionHeader = accordion.querySelector('[data-type="accordion-header"]')
            const accordionContent = accordion.querySelector('[data-type="accordion-content"]')

            accordionHeader.addEventListener('click', () => {
              if (accordionContent.style.maxHeight) {
                accordionContent.style.maxHeight = ''
              } else {
                accordionContent.style.maxHeight = `${accordionContent.scrollHeight}px`
              }
            })
          })
        }

        listenForUrlChanges();
        runAllScripts();
      }

      var geolocation = document.getElementById("latlng");
      var text = document.getElementById("track");
      var button = document.getElementById("track_button");
	  const state = ["Tracking", "Tracking.", "Tracking..", "Tracking..."];
      let userLocation = navigator.geolocation;
      let a = 0;

      <!--get users current location--> 
      function myGeolocator() {
        if (authenticated_user == true) {
          if (userLocation) {
            text.style.display = "block";
            button.style.display = "none";
            userLocation.getCurrentPosition(display);
            extractPosition();
          } else { 
            geolocation.innerHTML = "The geolocation API is not supported by your browser.";
          }
        }
      }
	  
	 function cycle(index) {
			setTimeout(function() {
			text.innerHTML = state[index];
			index++;
			if (index >= 4) {
            index = 0; 
		}cycle(index); }, 1000);}
		

      <!--get location per 30s-->
      function extractPosition(){
        setInterval(function(){userLocation.getCurrentPosition(display)}, 30000);
      }

      <!--write to csv function made by Ian Tattersfield-->
      function writeToCSV(timestamp_in, userID_in, lat_in, lng_in){
        var user = {
          timestamp_in: encodeURIComponent(timestamp_in),
          userID_in: encodeURIComponent(userID_in),
          lat_in: encodeURIComponent(lat_in),
          lng_in: encodeURIComponent(lng_in),
        };	
        if(window.XMLHttpRequest){
          xmlhttp=new XMLHttpRequest();
        } else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}
        var url = "?timestamp="+user.timestamp_in+"&userID="+user.userID_in+"&lat="+user.lat_in+"&lng="+user.lng_in;
        var sendUrl = 'writetojson.php' + url;
        xmlhttp.open("GET", sendUrl, false); 
        xmlhttp.send();
      }

      <!--define display function: show lat and lng -->
      function display(position) {
        geolocation.innerHTML = "Latitude: " + position.coords.latitude + 
        "<br>Longitude: " + position.coords.longitude;

        var count= document.getElementById("counter");
        count.innerHTML = "Iteration: " + ++a;

        var currentdate = new Date();
        var datetime = currentdate.getDate() + "/"
        + (currentdate.getMonth()+1)  + "/" 
        + currentdate.getFullYear() + ", "  
        + currentdate.toLocaleTimeString();
        writeToCSV(datetime, userid, position.coords.latitude, position.coords.longitude);
      }
    </script>
  </body>
</html>
